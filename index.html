<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ê¸‰ ì „ì²´ ë‚´ì‹  ì˜ˆì¸¡ ê³„ì‚°ê¸°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #f5f5f5;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 30px);
        }

        .header {
            background-color: white;
            padding: 10px 15px;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0 0 4px 0;
            font-size: 20px;
            color: #333;
        }

        .header p {
            font-size: 14px;
            color: #666;
            margin: 0;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px 15px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #6c757d;
            border-radius: 6px;
        }

        .tab-btn.active {
            background: #17a2b8;
            color: white;
        }

        .tab-content {
            display: none;
            flex: 1;
            overflow-y: auto;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        .form-section {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .semester-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .semester-title {
            background: #17a2b8;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            margin: -15px -15px 15px -15px;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .paste-area {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px dashed #ced4da;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            background: #fff;
            margin-bottom: 15px;
        }

        .paste-area:focus {
            outline: none;
            border-color: #4facfe;
            background: #f8f9ff;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 8px 14px;
            margin: 3px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-primary {
            background: #17a2b8;
            color: white;
        }

        .btn-primary:hover {
            background: #138496;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-blue {
            background: #007bff;
            color: white;
        }

        .btn-blue:hover {
            background: #0056b3;
        }

        .student-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #dee2e6;
        }

        .student-table th {
            background: #f8f9fa;
            color: #333;
            padding: 10px 8px;
            font-size: 12px;
            text-align: center;
            font-weight: bold;
            border-bottom: 2px solid #dee2e6;
        }

        .student-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
            font-size: 12px;
        }

        .student-table tbody tr:hover {
            background: #f8f9fa;
        }

        .prediction-input {
            width: 60px;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 11px;
        }

        .prediction-input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 3px rgba(79, 172, 254, 0.3);
        }

        .subjects-container {
            margin-top: 20px;
        }

        .subject-category {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .subject-category h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
        }

        .subject-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .subject-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .subject-item label {
            font-weight: bold;
            color: #495057;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .score-input {
            width: 80px;
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            text-align: center;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .score-input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 3px rgba(79, 172, 254, 0.3);
        }

        .achievement-select {
            width: 80px;
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            text-align: center;
            font-size: 14px;
        }

        .achievement-select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .achievement {
            font-size: 18px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            min-width: 30px;
            text-align: center;
        }

        .achievement.A { background: #28a745; color: white; }
        .achievement.B { background: #17a2b8; color: white; }
        .achievement.C { background: #ffc107; color: black; }
        .achievement.D { background: #fd7e14; color: white; }
        .achievement.E { background: #dc3545; color: white; }

        .prediction-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
            border-left: 4px solid #17a2b8;
        }

        .prediction-summary .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .prediction-summary .summary-item.total {
            font-size: 1.2em;
            font-weight: bold;
            padding-top: 10px;
            border-top: 2px solid #17a2b8;
        }

        .prediction-summary label {
            color: #17a2b8;
            font-weight: bold;
        }

        .prediction-summary span {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .prediction-summary input {
            width: 100px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
        }

        .student-number {
            font-weight: bold;
            color: #495057;
        }

        .current-score {
            color: #6c757d;
        }

        .predicted-score {
            color: #17a2b8;
            font-weight: bold;
        }

        .improvement {
            font-weight: bold;
        }

        .improvement.positive {
            color: #28a745;
        }

        .improvement.negative {
            color: #dc3545;
        }

        .improvement.neutral {
            color: #6c757d;
        }

        .summary-section {
            background: white;
            color: #333;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid #dee2e6;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .summary-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .summary-item h4 {
            margin-bottom: 8px;
            font-size: 1em;
        }

        .summary-item .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #17a2b8;
        }

        .instructions {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #0066cc;
            margin-bottom: 20px;
        }

        .instructions h3 {
            color: #0066cc;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .table-container {
            flex: 1;
            overflow-y: auto;
            border-radius: 6px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .student-table {
                font-size: 10px;
            }
            
            .student-table th,
            .student-table td {
                padding: 6px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>ğŸ“ í•™ê¸‰ ì „ì²´ ë‚´ì‹  ì˜ˆì¸¡ ê³„ì‚°ê¸°</h1>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showCurrentTab()">í˜„ì¬ ì„±ì  ì…ë ¥</button>
            <button class="tab-btn" onclick="showPredictionTab()">3í•™ë…„ 2í•™ê¸° ì˜ˆì¸¡ ë° ë¶„ì„</button>
        </div>

        <div id="currentTab" class="tab-content active">
            <div class="form-section">
                <div class="section-title">2í•™ë…„ 1í•™ê¸°ë¶€í„° 3í•™ë…„ 1í•™ê¸°ê¹Œì§€ ì„±ì </div>
                
                <div class="semester-section">
                    <div class="semester-title">
                        <span>í˜„ì¬ ì„±ì  (2í•™ë…„ 1í•™ê¸° ~ 3í•™ë…„ 1í•™ê¸°)</span>
                        <span id="currentCount">0ëª… ì…ë ¥ë¨</span>
                    </div>
                    <textarea id="currentPasteArea" class="paste-area" 
                        placeholder="í•™ìƒ ì„±ì  ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...&#10;&#10;ìƒˆë¡œìš´ í˜•ì‹:&#10;ë²ˆí˜¸ 2í•™ë…„ì ìˆ˜ 3í•™ë…„ì ìˆ˜ ì˜ˆì²´ëŠ¥ì ìˆ˜ í•©ê³„ í•™ê¸‰ì„ì°¨ í•™ë…„ì„ì°¨ ì´ì &#10;&#10;ì˜ˆì‹œ:&#10;1    48.526    25.600    25.500    58.400    5    12    182.126&#10;2    52.401    27.800    26.200    60.000    3    8     192.401&#10;3    50.828    26.400    25.800    59.200    4    10    185.828&#10;..."></textarea>
                    <div class="btn-group">
                        <button class="btn btn-blue" onclick="parseCurrentGrades()">í˜„ì¬ ì„±ì  ë¶„ì„</button>
                        <button class="btn btn-success" onclick="generatePredictionInputs()">3í•™ë…„ 2í•™ê¸° ì˜ˆì¸¡ ì…ë ¥ ìƒì„±</button>
                        <button class="btn btn-secondary" onclick="clearCurrentData()">ì´ˆê¸°í™”</button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="student-table">
                        <thead>
                            <tr>
                                <th>ë²ˆí˜¸</th>
                                <th>2í•™ë…„ì ìˆ˜</th>
                                <th>3í•™ë…„ì ìˆ˜</th>
                                <th>ì˜ˆì²´ëŠ¥ì ìˆ˜</th>
                                <th>í•©ê³„</th>
                                <th>í•™ê¸‰ì„ì°¨</th>
                                <th>í•™ë…„ì„ì°¨</th>
                                <th>í˜„ì¬ ì´ì </th>
                            </tr>
                        </thead>
                        <tbody id="currentTableBody">
                            <!-- í•™ìƒ ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="predictionTab" class="tab-content">
            <!-- ìƒë‹¨ í•™ìƒ ì„ íƒ -->
            <div class="form-section" style="margin-bottom: 20px;">
                <div class="section-title">
                    í•™ìƒ ì„ íƒ ë° ì˜ˆì¸¡ ì„±ì  ì…ë ¥
                    <div style="font-size: 14px; font-weight: normal;">
                        <select id="studentSelect" onchange="selectStudent()">
                            <option value="">í•™ìƒ ì„ íƒ...</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ (ì¢Œìš° ë¶„í• ) -->
            <div style="display: grid; grid-template-columns: 6fr 4fr; gap: 20px; height: calc(100vh - 200px);">
                <!-- ì¢Œì¸¡: ì˜ˆì¸¡ ì…ë ¥ ì˜ì—­ -->
                <div class="form-section" style="margin-bottom: 0; overflow-y: auto;">
                    <div class="semester-title" style="margin: -15px -15px 20px -15px;">
                        <span>3í•™ë…„ 2í•™ê¸° ê³¼ëª©ë³„ ì˜ˆì¸¡ ì„±ì </span>
                        <span id="selectedStudentName">í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</span>
                    </div>
                    
                    <div class="subjects-container" style="margin-top: 0;">
                        <div class="subject-category" style="margin-bottom: 15px; padding: 15px;">
                            <h4 style="margin-bottom: 12px; font-size: 16px;">3í•™ë…„ 2í•™ê¸° ê³¼ëª©ë³„ ì˜ˆì¸¡ ì„±ì </h4>
                            <div class="subject-grid" style="grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px;">
                                <div class="subject-item" style="padding: 8px;">
                                    <label style="font-size: 11px;">êµ­ì–´</label>
                                    <input type="number" id="korean" class="score-input" style="width: 50px; padding: 4px;" min="0" max="100" oninput="updateAchievement('korean')" placeholder="ì ìˆ˜">
                                    <span class="achievement" id="korean_achievement" style="font-size: 12px;">-</span>
                                </div>
                                <div class="subject-item" style="padding: 8px;">
                                    <label style="font-size: 11px;">ì‚¬íšŒ</label>
                                    <input type="number" id="social" class="score-input" style="width: 50px; padding: 4px;" min="0" max="100" oninput="updateAchievement('social')" placeholder="ì ìˆ˜">
                                    <span class="achievement" id="social_achievement" style="font-size: 12px;">-</span>
                                </div>
                                <div class="subject-item" style="padding: 8px;">
                                    <label style="font-size: 11px;">ì—­ì‚¬</label>
                                    <input type="number" id="history" class="score-input" style="width: 50px; padding: 4px;" min="0" max="100" oninput="updateAchievement('history')" placeholder="ì ìˆ˜">
                                    <span class="achievement" id="history_achievement" style="font-size: 12px;">-</span>
                                </div>
                                <div class="subject-item" style="padding: 8px;">
                                    <label style="font-size: 11px;">ìˆ˜í•™</label>
                                    <input type="number" id="math" class="score-input" style="width: 50px; padding: 4px;" min="0" max="100" oninput="updateAchievement('math')" placeholder="ì ìˆ˜">
                                    <span class="achievement" id="math_achievement" style="font-size: 12px;">-</span>
                                </div>
                                <div class="subject-item" style="padding: 8px;">
                                    <label style="font-size: 11px;">ê³¼í•™</label>
                                    <input type="number" id="science" class="score-input" style="width: 50px; padding: 4px;" min="0" max="100" oninput="updateAchievement('science')" placeholder="ì ìˆ˜">
                                    <span class="achievement" id="science_achievement" style="font-size: 12px;">-</span>
                                </div>
                                <div class="subject-item" style="padding: 8px;">
                                    <label style="font-size: 11px;">ê¸°ìˆ ê°€ì •</label>
                                    <input type="number" id="tech" class="score-input" style="width: 50px; padding: 4px;" min="0" max="100" oninput="updateAchievement('tech')" placeholder="ì ìˆ˜">
                                    <span class="achievement" id="tech_achievement" style="font-size: 12px;">-</span>
                                </div>
                                <div class="subject-item" style="padding: 8px;">
                                    <label style="font-size: 11px;">ì˜ì–´</label>
                                    <input type="number" id="english" class="score-input" style="width: 50px; padding: 4px;" min="0" max="100" oninput="updateAchievement('english')" placeholder="ì ìˆ˜">
                                    <span class="achievement" id="english_achievement" style="font-size: 12px;">-</span>
                                </div>
                                <div class="subject-item" style="padding: 8px;">
                                    <label style="font-size: 11px;">ì™¸êµ­ì–´</label>
                                    <input type="number" id="foreign" class="score-input" style="width: 50px; padding: 4px;" min="0" max="100" oninput="updateAchievement('foreign')" placeholder="ì ìˆ˜">
                                    <span class="achievement" id="foreign_achievement" style="font-size: 12px;">-</span>
                                </div>
                                <div class="subject-item" style="padding: 8px;">
                                    <label style="font-size: 11px;">ì²´ìœ¡</label>
                                    <select id="pe" class="achievement-select" style="width: 50px; padding: 4px; font-size: 11px;" onchange="calculatePredictedScore()">
                                        <option value="">ì„ íƒ</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                    </select>
                                </div>
                                <div class="subject-item" style="padding: 8px;">
                                    <label style="font-size: 11px;">ìŒì•…</label>
                                    <select id="music" class="achievement-select" style="width: 50px; padding: 4px; font-size: 11px;" onchange="calculatePredictedScore()">
                                        <option value="">ì„ íƒ</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="btn-group" style="margin-top: 15px;">
                            <button class="btn btn-primary" onclick="savePrediction()">í˜„ì¬ í•™ìƒ ì €ì¥</button>
                            <button class="btn btn-success" onclick="calculateIndividualResult()">ê°œë³„ ë¶„ì„</button>
                        </div>
                    </div>
                </div>

                <!-- ìš°ì¸¡: ë¶„ì„ ê²°ê³¼ ì˜ì—­ -->
                <div class="result-section" id="individualResult" style="display: none; overflow-y: auto; margin-bottom: 0;">
                    <!-- í—¤ë” ì„¹ì…˜ -->
                    <div style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); color: white; padding: 15px; border-radius: 8px 8px 0 0; position: relative; overflow: hidden;">
                        <div style="position: absolute; top: -30px; right: -30px; width: 60px; height: 60px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
                        <div style="position: absolute; bottom: -20px; left: -20px; width: 40px; height: 40px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
                        <div style="position: relative; z-index: 2;">
                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                <div style="background: rgba(255,255,255,0.2); padding: 6px 10px; border-radius: 15px; margin-right: 10px;">
                                    <span style="font-size: 12px; font-weight: bold;">ğŸ“Š ê°œë³„ ë¶„ì„</span>
                                </div>
                                <h3 id="analyzedStudentName" style="margin: 0; font-size: 18px;">-ë²ˆ í•™ìƒ</h3>
                            </div>
                            <p style="opacity: 0.9; margin: 0; font-size: 12px;">3í•™ë…„ 2í•™ê¸° ì˜ˆì¸¡ ì„±ì ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ìƒì„¸ ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤</p>
                        </div>
                    </div>

                    <!-- ì„±ì  ìš”ì•½ ì¹´ë“œ -->
                    <div style="background: white; padding: 15px; border-radius: 0 0 8px 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 15px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 12px; border-radius: 8px; text-align: center; border-left: 3px solid #6c757d;">
                                <div style="font-size: 10px; color: #6c757d; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">CURRENT</div>
                                <div style="font-size: 18px; font-weight: bold; color: #495057; margin-bottom: 2px;"><span id="studentCurrentTotal">0.000</span></div>
                                <div style="font-size: 11px; color: #6c757d;">í˜„ì¬ ë‚´ì‹ </div>
                            </div>
                            
                            <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 12px; border-radius: 8px; text-align: center; border-left: 3px solid #17a2b8;">
                                <div style="font-size: 10px; color: #17a2b8; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">PREDICTED</div>
                                <div style="font-size: 18px; font-weight: bold; color: #17a2b8; margin-bottom: 2px;"><span id="studentPredictedTotal">0.000</span></div>
                                <div style="font-size: 11px; color: #17a2b8;">ì˜ˆì¸¡ ë‚´ì‹ </div>
                            </div>
                            
                            <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 12px; border-radius: 8px; text-align: center; border-left: 3px solid #ff9800;">
                                <div style="font-size: 10px; color: #f57c00; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">CHANGE</div>
                                <div style="font-size: 18px; font-weight: bold; margin-bottom: 2px;"><span id="studentImprovement">+0.000</span></div>
                                <div style="font-size: 11px; color: #f57c00;">ìƒìŠ¹í­</div>
                            </div>
                            
                            <div style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); padding: 12px; border-radius: 8px; text-align: center; border-left: 3px solid #9c27b0;">
                                <div style="font-size: 10px; color: #7b1fa2; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">3-2 GRADE</div>
                                <div style="font-size: 18px; font-weight: bold; color: #7b1fa2; margin-bottom: 2px;"><span id="studentPredictionGrade">0.000</span></div>
                                <div style="font-size: 11px; color: #7b1fa2;">êµê³¼ ì˜ˆì¸¡</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ìƒì„¸ ë¶„ì„ -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <div style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); color: white; padding: 10px;">
                                <div style="display: flex; align-items: center;">
                                    <span style="font-size: 16px; margin-right: 8px;">ğŸ“‹</span>
                                    <h5 style="margin: 0; font-size: 14px; font-weight: bold;">í˜„ì¬ ìƒí™©</h5>
                                </div>
                            </div>
                            <div style="padding: 12px;">
                                <div id="currentAnalysis" style="font-size: 12px; line-height: 1.5; color: #495057;">
                                    <!-- í˜„ì¬ ìƒí™© ë¶„ì„ -->
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <div style="background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); color: white; padding: 10px;">
                                <div style="display: flex; align-items: center;">
                                    <span style="font-size: 16px; margin-right: 8px;">ğŸ”®</span>
                                    <h5 style="margin: 0; font-size: 14px; font-weight: bold;">ì˜ˆì¸¡ ê²°ê³¼</h5>
                                </div>
                            </div>
                            <div style="padding: 12px;">
                                <div id="predictionAnalysis" style="font-size: 12px; line-height: 1.5; color: #495057;">
                                    <!-- ì˜ˆì¸¡ ê²°ê³¼ ë¶„ì„ -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        let studentData = [];
        let predictionData = [];
        let currentSelectedStudent = null;
        let studentPredictions = {}; // í•™ìƒë³„ ì˜ˆì¸¡ ë°ì´í„° ì €ì¥

        const subjects = ['korean', 'social', 'history', 'math', 'science', 'tech', 'english', 'foreign'];
        const peArtsSubjects = ['pe', 'music'];

        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í‚¤ ìƒìˆ˜
        const STORAGE_KEYS = {
            STUDENT_DATA: 'gradeCalculator_studentData',
            PREDICTIONS: 'gradeCalculator_predictions'
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë³µì›
        document.addEventListener('DOMContentLoaded', function() {
            loadDataFromStorage();
        });

        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadDataFromStorage() {
            try {
                // í•™ìƒ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                const savedStudentData = localStorage.getItem(STORAGE_KEYS.STUDENT_DATA);
                if (savedStudentData) {
                    studentData = JSON.parse(savedStudentData);
                    if (studentData.length > 0) {
                        displayCurrentGrades();
                        document.getElementById('currentCount').textContent = `${studentData.length}ëª… ì…ë ¥ë¨`;
                        
                        // ì„±ì  ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ ì˜ì—­ì—ë„ í‘œì‹œ
                        const pasteArea = document.getElementById('currentPasteArea');
                        const dataText = studentData.map(student => 
                            `${student.number}\t${student.grade2Score}\t${student.grade3Score}\t${student.peArtsScore}\t${student.otherScore}\t${student.classRank}\t${student.gradeRank}\t${student.total}`
                        ).join('\n');
                        pasteArea.value = dataText;
                    }
                }

                // ì˜ˆì¸¡ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                const savedPredictions = localStorage.getItem(STORAGE_KEYS.PREDICTIONS);
                if (savedPredictions) {
                    studentPredictions = JSON.parse(savedPredictions);
                }

                console.log('ë°ì´í„°ë¥¼ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
            }
        }

        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„° ì €ì¥
        function saveDataToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.STUDENT_DATA, JSON.stringify(studentData));
                localStorage.setItem(STORAGE_KEYS.PREDICTIONS, JSON.stringify(studentPredictions));
                console.log('ë°ì´í„°ë¥¼ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í–ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°ì´í„° ì‚­ì œ
        function clearStorageData() {
            try {
                localStorage.removeItem(STORAGE_KEYS.STUDENT_DATA);
                localStorage.removeItem(STORAGE_KEYS.PREDICTIONS);
                console.log('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°ì´í„°ë¥¼ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚­ì œ ì‹¤íŒ¨:', error);
            }
        }

        function parseCurrentGrades() {
            const pasteArea = document.getElementById('currentPasteArea');
            const data = pasteArea.value.trim();
            
            if (!data) {
                alert('ì„±ì  ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const lines = data.split('\n').filter(line => line.trim());
                const students = [];
                
                lines.forEach(line => {
                    // íƒ­ì´ë‚˜ ì—¬ëŸ¬ ê³µë°±ìœ¼ë¡œ ë¶„ë¦¬
                    const values = line.trim().split(/\s+/).map(v => v.trim());
                    
                    if (values.length >= 8) {
                        const studentNum = parseInt(values[0]);
                        const grade2Score = parseFloat(values[1]);
                        const grade3Score = parseFloat(values[2]);
                        const peArtsScore = parseFloat(values[3]);
                        const otherScore = parseFloat(values[4]);
                        const classRank = parseInt(values[5]);
                        const gradeRank = parseInt(values[6]);
                        const total = parseFloat(values[7]);
                        
                        if (!isNaN(studentNum) && !isNaN(grade2Score) && !isNaN(grade3Score) && 
                            !isNaN(peArtsScore) && !isNaN(otherScore) && !isNaN(classRank) &&
                            !isNaN(gradeRank) && !isNaN(total)) {
                            students.push({
                                number: studentNum,
                                grade2Score: grade2Score,
                                grade3Score: grade3Score,
                                peArtsScore: peArtsScore,
                                otherScore: otherScore,
                                classRank: classRank,
                                gradeRank: gradeRank,
                                total: total
                            });
                        }
                    }
                });

                if (students.length === 0) {
                    alert('ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // ë²ˆí˜¸ìˆœìœ¼ë¡œ ì •ë ¬
                students.sort((a, b) => a.number - b.number);
                studentData = students;
                
                displayCurrentGrades();
                document.getElementById('currentCount').textContent = `${students.length}ëª… ì…ë ¥ë¨`;
                
                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                saveDataToStorage();
                
                alert(`${students.length}ëª…ì˜ í˜„ì¬ ì„±ì ì„ ì…ë ¥í–ˆìŠµë‹ˆë‹¤.`);

            } catch (error) {
                alert('ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error(error);
            }
        }

        function displayCurrentGrades() {
            const tbody = document.getElementById('currentTableBody');
            tbody.innerHTML = '';

            studentData.forEach(student => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td class="student-number">${student.number}</td>
                    <td>${student.grade2Score.toFixed(3)}</td>
                    <td>${student.grade3Score.toFixed(3)}</td>
                    <td>${student.peArtsScore.toFixed(3)}</td>
                    <td>${student.otherScore.toFixed(1)}</td>
                    <td>${student.classRank}</td>
                    <td>${student.gradeRank}</td>
                    <td class="current-score">${student.total.toFixed(1)}</td>
                `;
            });
        }

        function generatePredictionInputs() {
            if (studentData.length === 0) {
                alert('ë¨¼ì € í˜„ì¬ ì„±ì ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // í•™ìƒ ì„ íƒ ë“œë¡­ë‹¤ìš´ ìƒì„±
            const studentSelect = document.getElementById('studentSelect');
            studentSelect.innerHTML = '<option value="">í•™ìƒ ì„ íƒ...</option>';
            
            studentData.forEach(student => {
                const option = document.createElement('option');
                option.value = student.number;
                option.textContent = `${student.number}ë²ˆ`;
                studentSelect.appendChild(option);
            });

            // ì˜ˆì¸¡ í˜„í™© í…Œì´ë¸” ì´ˆê¸°í™”
            updatePredictionSummaryTable();

            // ê¸°ì¡´ ì˜ˆì¸¡ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ì²« ë²ˆì§¸ í•™ìƒ ì„ íƒ
            if (Object.keys(studentPredictions).length > 0) {
                const firstStudentWithPrediction = Object.keys(studentPredictions)[0];
                studentSelect.value = firstStudentWithPrediction;
                selectStudent();
            }

            // ì˜ˆì¸¡ íƒ­ìœ¼ë¡œ ì´ë™
            showTab('prediction');
        }

        function selectStudent() {
            const studentSelect = document.getElementById('studentSelect');
            const studentNumber = parseInt(studentSelect.value);
            
            if (!studentNumber) {
                document.getElementById('selectedStudentName').textContent = 'í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”';
                clearPredictionForm();
                currentSelectedStudent = null;
                return;
            }

            currentSelectedStudent = studentNumber;
            document.getElementById('selectedStudentName').textContent = `${studentNumber}ë²ˆ í•™ìƒ`;

            // ê¸°ì¡´ ì˜ˆì¸¡ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë¡œë“œ
            if (studentPredictions[studentNumber]) {
                loadPredictionData(studentPredictions[studentNumber]);
            } else {
                clearPredictionForm();
            }
        }

        function clearPredictionForm() {
            // ëª¨ë“  ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            subjects.forEach(subject => {
                const input = document.getElementById(subject);
                const achievement = document.getElementById(subject + '_achievement');
                if (input) input.value = '';
                if (achievement) {
                    achievement.textContent = '-';
                    achievement.className = 'achievement';
                }
            });
            
            peArtsSubjects.forEach(subject => {
                const input = document.getElementById(subject);
                if (input) input.value = '';
            });

            // ì˜ˆì¸¡ ì ìˆ˜ ì´ˆê¸°í™”
            const predictedScore = document.getElementById('studentPredictionGrade');
            if (predictedScore) predictedScore.textContent = '0.0';
        }

        function loadPredictionData(data) {
            // ì¼ë°˜ êµê³¼
            subjects.forEach(subject => {
                if (data[subject]) {
                    document.getElementById(subject).value = data[subject];
                    updateAchievement(subject);
                }
            });
            
            // ì˜ˆì²´ëŠ¥
            peArtsSubjects.forEach(subject => {
                if (data[subject]) {
                    document.getElementById(subject).value = data[subject];
                }
            });

            // ê¸°íƒ€í™œë™ì€ ìë™ ê³„ì‚°ë˜ë¯€ë¡œ ë¶ˆëŸ¬ì˜¤ê¸° ë¶ˆí•„ìš”

            calculatePredictedScore();
        }

        function updateAchievement(subject) {
            const scoreInput = document.getElementById(subject);
            const achievementSpan = document.getElementById(subject + '_achievement');
            const score = parseFloat(scoreInput.value);

            if (isNaN(score) || score === '') {
                achievementSpan.textContent = '-';
                achievementSpan.className = 'achievement';
            } else {
                let achievement;
                if (score >= 90) achievement = 'A';
                else if (score >= 80) achievement = 'B';
                else if (score >= 70) achievement = 'C';
                else if (score >= 60) achievement = 'D';
                else achievement = 'E';

                achievementSpan.textContent = achievement;
                achievementSpan.className = `achievement ${achievement}`;
            }

            calculatePredictedScore();
        }

        function calculatePredictedScore() {
            // 3-2í•™ê¸° êµê³¼í™œë™ ì ìˆ˜ ê³„ì‚° (30ì  ë§Œì )
            let regularSubjectSum = 0;
            let regularSubjectCount = 0;
            let achievementSum = 0;

            subjects.forEach(subject => {
                const score = parseFloat(document.getElementById(subject).value);
                if (!isNaN(score) && score > 0) {
                    regularSubjectSum += score;
                    regularSubjectCount++;

                    // ì„±ì·¨ë„ ì ìˆ˜ ê³„ì‚° (A=5, B=4, C=3, D=2, E=1)
                    let achievementScore;
                    if (score >= 90) achievementScore = 5;
                    else if (score >= 80) achievementScore = 4;
                    else if (score >= 70) achievementScore = 3;
                    else if (score >= 60) achievementScore = 2;
                    else achievementScore = 1;
                    
                    achievementSum += achievementScore;
                }
            });

            if (regularSubjectCount === 0) {
                const predictedScore = document.getElementById('studentPredictionGrade');
            if (predictedScore) predictedScore.textContent = '0.0';
                return;
            }

            // êµê³¼í™œë™: ê¸°ë³¸ 10ì  + (ì„±ì·¨ë„ í‰ê·  Ã— 2) + (ì›ì ìˆ˜ í‰ê·  Ã— 0.1)
            const baseScore = 10;
            const achievementAverage = achievementSum / regularSubjectCount;
            const achievementScore = achievementAverage * 2;
            const rawScoreAverage = regularSubjectSum / regularSubjectCount;
            const rawScoreBonus = rawScoreAverage * 0.1;

            const semesterSubjectScore = baseScore + achievementScore + rawScoreBonus;

            const predictedScore = document.getElementById('studentPredictionGrade');
            if (predictedScore) predictedScore.textContent = semesterSubjectScore.toFixed(1);
        }

        // ì˜ˆì²´ëŠ¥ ì ìˆ˜ ê³„ì‚° (6ê³¼ëª© â†’ 8ê³¼ëª© í™˜ì‚°)
        function calculatePeArtsScore(currentPeArtsScore, newPeAchievements) {
            // í˜„ì¬ ì˜ˆì²´ëŠ¥ì´ ë§Œì (30ì )ì¸ ê²½ìš°ì˜ ì²˜ë¦¬
            if (currentPeArtsScore >= 29.9) {
                // ì¶”ê°€ ê³¼ëª©ì´ ëª¨ë‘ Aë¼ë©´ ì—¬ì „íˆ ë§Œì 
                const allA = newPeAchievements.every(achievement => achievement === 'A');
                if (allA && newPeAchievements.length === 2) {
                    return 30.0;
                }
            }
            
            // í˜„ì¬ 6ê³¼ëª©ì—ì„œ ê¸°ë³¸ì ìˆ˜ ì œê±° í›„ ì„±ì·¨ë„ë³„ ê°€ì¤‘ì¹˜ ê³„ì‚°
            const currentScore = currentPeArtsScore - 10; // ê¸°ë³¸ 10ì  ì œê±°
            const currentRatio = currentScore / 20; // 0~1 ì‚¬ì´ ë¹„ìœ¨
            
            // 6ê³¼ëª©ì˜ ê°€ì¤‘í•©ì„ ì¶”ì • (6ê³¼ëª© Ã— 3ì  = 18ì  ë§Œì )
            const current6SubjectWeightedSum = currentRatio * 18;
            
            // ìƒˆë¡œ ì¶”ê°€ë  2ê³¼ëª©ì˜ ê°€ì¤‘í•© ê³„ì‚°
            let new2SubjectWeightedSum = 0;
            newPeAchievements.forEach(achievement => {
                if (achievement === 'A') new2SubjectWeightedSum += 3;
                else if (achievement === 'B') new2SubjectWeightedSum += 2;
                else if (achievement === 'C') new2SubjectWeightedSum += 1;
            });
            
            // 8ê³¼ëª© ì´ ê°€ì¤‘í•© (8ê³¼ëª© Ã— 3ì  = 24ì  ë§Œì )
            const total8SubjectWeightedSum = current6SubjectWeightedSum + new2SubjectWeightedSum;
            const finalRatio = total8SubjectWeightedSum / 24;
            
            // ìµœì¢… ì ìˆ˜ = ê¸°ë³¸ 10ì  + ì„±ì·¨ë„ ë¹„ë¡€ 20ì 
            const finalScore = 10 + finalRatio * 20;
            
            return Math.min(finalScore, 30); // ìµœëŒ€ 30ì ìœ¼ë¡œ ì œí•œ
        }

        function savePrediction() {
            if (!currentSelectedStudent) {
                alert('í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // 3-2í•™ê¸°ëŠ” êµê³¼í™œë™ë§Œ ì˜ˆì¸¡, ì¶œê²°/ë´‰ì‚¬/í•™êµí™œë™ì€ ì˜ˆì¸¡í•˜ì§€ ì•ŠìŒ
            const predictionData = {};

            // ì¼ë°˜êµê³¼ ë°ì´í„° ì €ì¥
            subjects.forEach(subject => {
                const score = parseFloat(document.getElementById(subject).value);
                if (!isNaN(score)) {
                    predictionData[subject] = score;
                }
            });

            // ì˜ˆì²´ëŠ¥ ë°ì´í„° ì €ì¥
            peArtsSubjects.forEach(subject => {
                const achievement = document.getElementById(subject).value;
                if (achievement) {
                    predictionData[subject] = achievement;
                }
            });

            studentPredictions[currentSelectedStudent] = predictionData;
            updatePredictionSummaryTable();
            
            // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            saveDataToStorage();
            
            alert(`${currentSelectedStudent}ë²ˆ í•™ìƒì˜ ì˜ˆì¸¡ ì„±ì ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        function applyToAll() {
            if (!currentSelectedStudent || !studentPredictions[currentSelectedStudent]) {
                alert('ë¨¼ì € í˜„ì¬ í•™ìƒì˜ ì˜ˆì¸¡ ì„±ì ì„ ì €ì¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const baseData = studentPredictions[currentSelectedStudent];
            
            studentData.forEach(student => {
                if (student.number !== currentSelectedStudent) {
                    studentPredictions[student.number] = { ...baseData };
                }
            });

            updatePredictionSummaryTable();
            
            // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            saveDataToStorage();
            
            alert('ëª¨ë“  í•™ìƒì—ê²Œ ë™ì¼í•œ ì˜ˆì¸¡ ì„±ì ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function updatePredictionSummaryTable() {
            // ì˜ˆì¸¡ ìš”ì•½ í…Œì´ë¸”ì´ ì œê±°ë˜ì—ˆìœ¼ë¯€ë¡œ ì´ í•¨ìˆ˜ëŠ” ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•ŠìŒ
            // ë¹ˆ í•¨ìˆ˜ë¡œ ìœ ì§€í•˜ì—¬ í˜¸ì¶œ ì‹œ ì˜¤ë¥˜ë¥¼ ë°©ì§€
        }

        function calculateIndividualResult() {
            if (!currentSelectedStudent) {
                alert('í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const prediction = studentPredictions[currentSelectedStudent];
            if (!prediction) {
                alert('ì˜ˆì¸¡ ì„±ì ì„ ë¨¼ì € ì €ì¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const student = studentData.find(s => s.number === currentSelectedStudent);
            if (!student) {
                alert('í•´ë‹¹ í•™ìƒì˜ í˜„ì¬ ì„±ì ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // í˜„ì¬ ë‚´ì‹  ì ìˆ˜
            const currentTotal = student.total;
            
            // ìƒˆë¡œìš´ ë°ì´í„° êµ¬ì¡° ì‚¬ìš©
            const current2ndGrade = student.grade2Score; // 2í•™ë…„ 60ì  (ê·¸ëŒ€ë¡œ ìœ ì§€)
            const current3rdGradeTotal = student.grade3Score; // 3í•™ë…„ 60ì  ë§Œì  (ì´ë¯¸ í™˜ì‚°ë¨)
            const current3rdGrade1Sem = current3rdGradeTotal / 2; // 3-1í•™ê¸° ì‹¤ì œ ì ìˆ˜ (30ì )
            const currentPeArts = student.peArtsScore; // í˜„ì¬ ì˜ˆì²´ëŠ¥ (6ê³¼ëª©)
            const currentOtherScore = currentTotal - (current2ndGrade + current3rdGradeTotal + currentPeArts); // ê¸°íƒ€ = ì´ì  - í•©ê³„

            // 3-2í•™ê¸° êµê³¼í™œë™ ì ìˆ˜ ê³„ì‚° (30ì  ë§Œì )
            let prediction3rdGrade2Sem = 0;
            let regularSum = 0, regularCount = 0;
            let achievementSum = 0;

            subjects.forEach(subject => {
                if (prediction[subject]) {
                    const score = prediction[subject];
                    regularSum += score;
                    regularCount++;
                    
                    // ì„±ì·¨ë„ ì ìˆ˜ ê³„ì‚°
                    let achievementScore;
                    if (score >= 90) achievementScore = 5;
                    else if (score >= 80) achievementScore = 4;
                    else if (score >= 70) achievementScore = 3;
                    else if (score >= 60) achievementScore = 2;
                    else achievementScore = 1;
                    
                    achievementSum += achievementScore;
                }
            });

            if (regularCount > 0) {
                // êµê³¼í™œë™: ê¸°ë³¸ 10ì  + (ì„±ì·¨ë„ í‰ê·  Ã— 2) + (ì›ì ìˆ˜ í‰ê·  Ã— 0.1)
                const baseScore = 10;
                const achievementAverage = achievementSum / regularCount;
                const achievementScore = achievementAverage * 2;
                const rawScoreAverage = regularSum / regularCount;
                const rawScoreBonus = rawScoreAverage * 0.1;
                
                prediction3rdGrade2Sem = baseScore + achievementScore + rawScoreBonus;
            }

            // ì˜ˆì²´ëŠ¥ ì ìˆ˜ ê³„ì‚° (6ê³¼ëª© â†’ 8ê³¼ëª©)
            const newPeAchievements = [];
            peArtsSubjects.forEach(subject => {
                if (prediction[subject]) {
                    newPeAchievements.push(prediction[subject]);
                }
            });
            
            const finalPeArtsScore = calculatePeArtsScore(currentPeArts, newPeAchievements);

            // ìµœì¢… ê³„ì‚°
            const final2ndGrade = current2ndGrade; // 2í•™ë…„ì€ ê·¸ëŒ€ë¡œ
            const final3rdGrade = current3rdGrade1Sem + prediction3rdGrade2Sem; // 3í•™ë…„ = 1í•™ê¸° + 2í•™ê¸°
            const finalOtherScore = currentOtherScore; // ê¸°íƒ€í™œë™ì€ ë³€ë™ ì—†ìŒ
            
            const finalPredictedTotal = final2ndGrade + final3rdGrade + finalPeArtsScore + finalOtherScore;
            const improvement = finalPredictedTotal - currentTotal;

            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('analyzedStudentName').textContent = `${currentSelectedStudent}ë²ˆ í•™ìƒ`;
            document.getElementById('studentCurrentTotal').textContent = currentTotal.toFixed(3);
            document.getElementById('studentPredictedTotal').textContent = finalPredictedTotal.toFixed(3);
            document.getElementById('studentImprovement').textContent = (improvement >= 0 ? '+' : '') + improvement.toFixed(3);
            document.getElementById('studentPredictionGrade').textContent = prediction3rdGrade2Sem.toFixed(3);

            // ìƒìŠ¹í­ì— ë”°ë¥¸ ìƒ‰ìƒ ì„¤ì •
            const improvementElement = document.getElementById('studentImprovement');
            if (improvement > 0) {
                improvementElement.style.color = '#28a745';
            } else if (improvement < 0) {
                improvementElement.style.color = '#dc3545';
            } else {
                improvementElement.style.color = '#6c757d';
            }

            // ìƒì„¸ ë¶„ì„
            const currentAnalysis = document.getElementById('currentAnalysis');
            // 3í•™ë…„ í•™ê¸° í‰ê·  ê³„ì‚° (30ì  ë§Œì  ê¸°ì¤€)
            const grade3Average = current3rdGrade1Sem; // í˜„ì¬ëŠ” 3-1í•™ê¸°ë§Œ ìˆìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            
            currentAnalysis.innerHTML = `
                â€¢ 2í•™ë…„ ì ìˆ˜: ${current2ndGrade.toFixed(3)}ì  (60ì  ë§Œì )<br>
                â€¢ 3í•™ë…„ í˜„ì¬: ${current3rdGradeTotal.toFixed(3)}ì  (60ì  ë§Œì )<br>
                â€¢ 3-1í•™ê¸° ì‹¤ì œ: ${current3rdGrade1Sem.toFixed(3)}ì  (30ì )<br>
                â€¢ <strong>3í•™ë…„ í•™ê¸°í‰ê· : ${grade3Average.toFixed(3)}ì  (30ì )</strong><br>
                â€¢ ì˜ˆì²´ëŠ¥ ì ìˆ˜: ${currentPeArts.toFixed(3)}ì  (6ê³¼ëª©)<br>
                â€¢ ê¸°íƒ€ ì ìˆ˜: ${currentOtherScore.toFixed(1)}ì  (ì¶œê²°/ë´‰ì‚¬/í•™êµ)<br>
                â€¢ í˜„ì¬ ì´ì : ${currentTotal.toFixed(1)}ì 
            `;

            const predictionAnalysis = document.getElementById('predictionAnalysis');
            // 3-2í•™ê¸°ì™€ 3-1í•™ê¸°(í˜„ì¬ í‰ê· ) ë¹„êµ ê³„ì‚°
            const semesterImprovement = prediction3rdGrade2Sem - grade3Average;
            const improvementText = semesterImprovement >= 0 ? `+${semesterImprovement.toFixed(3)}` : semesterImprovement.toFixed(3);
            
            predictionAnalysis.innerHTML = `
                â€¢ 3-2í•™ê¸° ì˜ˆì¸¡: ${prediction3rdGrade2Sem.toFixed(3)}ì  (30ì )<br>
                â€¢ <strong>í•™ê¸°ê°„ ë¹„êµ: ${improvementText}ì </strong> (vs 3í•™ë…„ í‰ê· )<br>
                â€¢ 3í•™ë…„ ìµœì¢…: ${final3rdGrade.toFixed(3)}ì  (60ì  ë§Œì )<br>
                â€¢ ì˜ˆì²´ëŠ¥ ìµœì¢…: ${finalPeArtsScore.toFixed(3)}ì  (8ê³¼ëª©)<br>
                â€¢ ê¸°íƒ€ ì ìˆ˜: ${finalOtherScore.toFixed(1)}ì  (ë³€ë™ì—†ìŒ)<br>
                â€¢ ì˜ˆì¸¡ ì´ì : ${finalPredictedTotal.toFixed(1)}ì <br>
                â€¢ ì´ ìƒìŠ¹í­: ${(improvement >= 0 ? '+' : '') + improvement.toFixed(1)}ì 
            `;

            // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('individualResult').style.display = 'block';
        }

        // ì´ í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ (ì „ì²´ ê²°ê³¼ íƒ­ì´ ì œê±°ë¨)
        function calculateAllFinalResults() {
            alert('ê°œë³„ ë¶„ì„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”. í•™ìƒì„ ì„ íƒí•˜ê³  "ê°œë³„ ë¶„ì„" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');
        }

        function clearAllPredictionData() {
            studentPredictions = {};
            updatePredictionSummaryTable();
            clearPredictionForm();
            alert('ëª¨ë“  ì˜ˆì¸¡ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function displayResults() {
            if (predictionData.length === 0) return;

            // í˜„ì¬ ìˆœìœ„ ê³„ì‚°
            const currentRanked = [...predictionData].sort((a, b) => b.currentTotal - a.currentTotal);
            const predictedRanked = [...predictionData].sort((a, b) => b.predictedTotal - a.predictedTotal);
            
            // ìˆœìœ„ ì •ë³´ ì¶”ê°€
            currentRanked.forEach((student, index) => {
                student.currentRank = index + 1;
            });
            
            predictedRanked.forEach((student, index) => {
                student.predictedRank = index + 1;
            });

            // ê²°ê³¼ í…Œì´ë¸” ìƒì„± (ì¡´ì¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì²´í¬)
            const tbody = document.getElementById('resultTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';

            // ë²ˆí˜¸ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ í‘œì‹œ
            const sortedForDisplay = [...predictionData].sort((a, b) => a.number - b.number);
            
            sortedForDisplay.forEach(student => {
                const row = tbody.insertRow();
                const rankChange = student.currentRank - student.predictedRank;
                const rankChangeText = rankChange > 0 ? `â†‘${rankChange}` : rankChange < 0 ? `â†“${Math.abs(rankChange)}` : 'â†’';
                const rankChangeClass = rankChange > 0 ? 'positive' : rankChange < 0 ? 'negative' : 'neutral';
                const improvementClass = student.improvement > 0 ? 'positive' : student.improvement < 0 ? 'negative' : 'neutral';
                
                row.innerHTML = `
                    <td class="student-number">${student.number}</td>
                    <td class="current-score">${student.currentTotal.toFixed(1)}</td>
                    <td class="predicted-score">${student.predictedTotal.toFixed(1)}</td>
                    <td class="improvement ${improvementClass}">${student.improvement >= 0 ? '+' : ''}${student.improvement.toFixed(1)}</td>
                    <td>${student.currentRank}</td>
                    <td>${student.predictedRank}</td>
                    <td class="improvement ${rankChangeClass}">${rankChangeText}</td>
                `;
            });

            // ìš”ì•½ í†µê³„ ê³„ì‚° (ìš”ì†Œë“¤ì´ ì¡´ì¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì²´í¬)
            const totalStudents = predictionData.length;
            const currentAverage = predictionData.reduce((sum, s) => sum + s.currentTotal, 0) / totalStudents;
            const predictedAverage = predictionData.reduce((sum, s) => sum + s.predictedTotal, 0) / totalStudents;
            const averageImprovement = predictedAverage - currentAverage;

            const totalStudentsEl = document.getElementById('totalStudents');
            const currentAverageEl = document.getElementById('currentAverage');
            const predictedAverageEl = document.getElementById('predictedAverage');
            const averageImprovementEl = document.getElementById('averageImprovement');

            if (totalStudentsEl) totalStudentsEl.textContent = totalStudents;
            if (currentAverageEl) currentAverageEl.textContent = currentAverage.toFixed(1);
            if (predictedAverageEl) predictedAverageEl.textContent = predictedAverage.toFixed(1);
            if (averageImprovementEl) averageImprovementEl.textContent = (averageImprovement >= 0 ? '+' : '') + averageImprovement.toFixed(1);
        }

        function clearCurrentData() {
            if (confirm('í˜„ì¬ ì„±ì  ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('currentPasteArea').value = '';
                document.getElementById('currentTableBody').innerHTML = '';
                document.getElementById('currentCount').textContent = '0ëª… ì…ë ¥ë¨';
                studentData = [];
                studentPredictions = {};
                
                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œë„ ì‚­ì œ
                clearStorageData();
                
                alert('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì´ í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ (í•´ë‹¹ HTML ìš”ì†Œë“¤ì´ ì œê±°ë¨)
        function clearPredictionData() {
            predictionData = [];
        }

        function showCurrentTab() {
            // ëª¨ë“  íƒ­ ì»¨í…ì¸ ì™€ ë²„íŠ¼ ì´ˆê¸°í™”
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // í˜„ì¬ ì„±ì  ì…ë ¥ íƒ­ í™œì„±í™”
            document.getElementById('currentTab').classList.add('active');
            event.target.classList.add('active');
        }

        function showPredictionTab() {
            // ëª¨ë“  íƒ­ ì»¨í…ì¸ ì™€ ë²„íŠ¼ ì´ˆê¸°í™”
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // ì˜ˆì¸¡ ë° ë¶„ì„ íƒ­ í™œì„±í™”
            document.getElementById('predictionTab').classList.add('active');
            event.target.classList.add('active');
        }

        // ê¸°ì¡´ showTab í•¨ìˆ˜ë„ ìœ ì§€ (ë‹¤ë¥¸ ê³³ì—ì„œ í˜¸ì¶œë  ìˆ˜ ìˆìŒ)
        function showTab(tabName) {
            if (tabName === 'current') {
                showCurrentTab();
            } else if (tabName === 'prediction') {
                showPredictionTab();
            }
        }
    </script>
</body>
</html>
